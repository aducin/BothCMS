<!DOCTYPE html>
<html lang="pl">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Wyniki wyszukiwania produktów</title>
	<style type="text/css">
	#table{
		border: 2px ridge purple;background-color:white;width: 950px;
	}
	#disc{
		color: gold;
	}
	#confirm{
		border: 2px ridge black;width=80%;background-color:yellow;width: 940px;
	}
	#tracking{
		background-color: #ffffe3;border: 2px ridge purple
	}
		</style>
</head>
<body>
	<?php if(isset($query)){ 
		if(isset($_GET['oldorder'])and $_GET['oldorder']!=''){
		$panel='Stary panel: ';
		$edycja='Kompletna edycja w SP';
		$fullAction='fullEditionO';
		$uaktualnij='Wyrównaj ilość w nowej bazie';
		$action='BPSQN';
		$uaktualnij2='Uaktualnij ilości dla całego zamówienia';
		$uaktualnij3='Zmiana obu przez stary panel';
		$order=$_GET['oldorder'];
		}
		if(isset($_GET['neworder'])and $_GET['neworder']!=''){
		$panel='Nowy panel: ';	
		$edycja='Kompletna edycja w NP';
		$fullAction='fullEditionN';
		$uaktualnij='Wyrównaj ilość w starej bazie';
		$action='BPSQO';
		$uaktualnij2='Uaktualnij ilości w całym zamówieniu';
		$uaktualnij3='Zmiana obu przez nowy panel';
		$order=$_GET['neworder'];
		}
		if(!isset($this)){
			echo'<b>'.'W bazie danych nie ma zamówienia o podanym numerze.'.'</b>'; exit; 
		} else { ?>
		<h1>Wyniki wyszukiwania</h1>
		<?php if(isset($_GET['neworder'])OR isset($_GET['oldorder'])) { ?>
		<fieldset><table><th>Numer ID</th><th>Nazwa</th><th>Na stanie (SP)</th><th>Zamówione (SP)</th><th>Opcje</th>
			<?php foreach ($this as $stry):?>
			<tr>
				<td><center>
					<?php htmlout($stry["id"]); ?></td><td>
					<?php htmlout($panel); ?><b><?php htmlout($stry['name']);?></b><br><?php
					try
					{
						if($_GET['oldorder']!='')
						{
							$product1= new LinuxPlProduct($firstHost, $firstLogin, $firstPassword);
							$query = $product1->getName($stry["id"]);
							if ($query!=$stry["name"]){
								?>Stary panel: 
								<?php htmlout($query);
							}
							else {
								echo 'Zgodność nazw produktu ID '.$stry["id"].' w obu bazach';
							}
						}
						elseif($_GET['neworder']!='')
						{
						$product2= new OgicomProduct($secondHost, $secondLogin, $secondPassword);
						$query = $product2->getName($stry["id"]);
							if ($query!=$stry["name"]){
								?>Stary panel: 
								<?php htmlout($query);
							}
							else {
								echo 'Zgodność nazw produktu ID '.$stry["id"].' w obu bazach';
							}
						}
					}
					catch (PODException $e)
					{
						echo 'Błąd przy pobieraniu listy wybranych kategorii: ' . $e->getMessage();
						exit(); } ?>
					</td><td><center>
					<?php htmlout($stry["quantity"]); ?>
					<form action="?" method="get">
						<div>
							<input type="hidden" name="id" value="<?php htmlout($stry["id"]); ?>">
							<input type="hidden" name="quantity" value="<?php htmlout($stry["quantity"]); ?>">
							<center><input type="submit" name="<?php htmlout($action)?>" value="<?php htmlout($uaktualnij); ?>">
							</div></td><td><center>
									<?php htmlout($stry["onStock"]); ?></td><td>
								<div>
									<center><input type="submit" name="<?php htmlout($fullAction);?>" value="<?php htmlout($edycja); ?>">
									</div>
					<div>
						<center><input type="submit" name="shortEdition" value="<?php htmlout($uaktualnij3); ?>">
					</div></form></td></tr>
									<?php endforeach; } } ?>
								<br></table>
<form action="?" method="get">
<div>
<input type="hidden" name="id_number" value="<?php htmlout ($order); ?>">
<center><input type="submit" name="action" value="<?php htmlout($uaktualnij2); ?>">
</div>
</form></fieldset><?php }
if(isset($_GET['detailorder'])and $_GET['detailorder']!=''){ 
	if(!isset($detail2)){
			echo'<b>'.'W bazie danych nie ma zamówienia o podanym numerze.'.'</b>'; exit; 
		} else {?>
<fieldset><table id="table"><th>Numer ID</th><th>Nazwa</th><th>Cena jednostkowa</th><th>Zniżka</th>
<th>Zamówiona ilość</th><th>Suma</th><th>Cena jedn. po rabacie</th><th>Suma po rabacie</th>
	<?php foreach ($detail2 as $sDetail1):?>
	<tr>
		<td><center>
<?php htmlout($sDetail1["id"]); ?></td><td>
<?php htmlout($sDetail1["name"]); ?></td><td><center>
<?php $newP1=number_format($sDetail1["price"], 2,'.','');
echo$newP1.'zł'; ?></td><td><center>
<?php if($sDetail1["reduction"]!=0) {
$newP2=number_format($sDetail1["reduction"], 2,'.','');
echo$newP2.'zł';
$sDetail1["price"]=$newP1-$newP2; }
else {echo'- -'; } ?></td><td><center>
<?php htmlout($sDetail1["quantity"]); ?></td><td><center>
<?php $newP=number_format($sDetail1["total"], 2,'.','');
echo$newP.'zł'; ?></td>
<td id='disc'><center><?php $newP=$sDetail1["price"]*0.85;
$newP2=number_format($newP, 2,'.','');
echo$newP2.'zł'; ?></td>
<td id='disc'><center><?php $newP=$sDetail1["total"]*0.85;
$newP3=number_format($newP, 2,'.','');
echo$newP3.'zł'; ?>
</tr>
<?php endforeach; ?></table>
<table><tr><td>
Suma wszystkich produktów:</td><td><?php echo$sDetail1["productSum"].'zł'; ?></td></tr><tr><td>
Suma po rabacie:</td><td id='disc'><?php $new4=$sDetail1["productSum"]*0.85;
$new5=number_format($new4, 2,'.','');
echo$new5.'zł'; ?>
</td></tr><tr><td>
Suma produktów z wysyłką:</td><td><?php echo$sDetail1["totalPaid"].'zł'; ?></td></tr><tr><td>
Suma z wysyłką po rabacie:</td><td id='disc'><?php $new6=$sDetail1["totalPaid"]*0.85;$new7=number_format($new6, 2,'.','');
echo$new7.'zł'; ?>
</td></tr></table></fieldset>
<?php if(isset($_GET['mail'])) 
{
$to= $sDetail1["mail"]; //'ad9bis@gmail.com'
$subject= 'Ad9bis - zamówienie z 15% rabatem';
if($sDetail1['payment']=='Płatność przy odbiorze'){
$message='
<html>
<head>
<meta charset="utf-8">
<title>Dziękujemy za ostatni zakup dokonany w sklepie Ad9bis.pl</title>
</head>
<body>
Witaj <b>'.$sDetail1['first'].' '.$sDetail1['last'].'</b>!
<br><br>
Dziękujemy za zamówienie nr <b>'.$sDetail1['reference'].' </b>złożone w sklepie Modele-Ad9bis!<br>
W związku z faktem, iż było to 6. zamówienie spełniające kryteria promocji, przysługuje Ci 15% rabat.<br> Wartość zamówienia po aktualizacji o wspomniany rabat przedstawia się następująco:<br><br>
Ilość zamówionych pozycji: <b>'.$count.'</b><br>
Suma produktów z wysyłką (przed rabatem): '.$sDetail1["totalPaid"].'zł'.'<br>'.'Suma z wysyłką po rabacie: '.'<b>'.$new7.'zł'.'</b><br>
Wybrałeś płatność pobraniową - kwota do zapłaty przy odbiorze równa się sumie z wysyłką po rabacie.
<br><br>Zapraszamy do korzystania z naszego sklepu w przyszłości!<br><br>
Pozdrawiam serdecznie,<br>
Albert Ducin<br>
----------------------<br>
P.H.U. Ad9bis<br>
ul. Świerkowa 22,<br>
20-834 - Lublin<br>
(48) 660413844<br>
ad9bis@gmail.com
</body>
</html>
</body>
</html>
'; }
elseif($sDetail1['payment']=="Przelew bankowy"){
$message='
<html>
<head>
<meta charset="utf-8">
<title>Dziękujemy za ostatni zakup dokonany w sklepie Ad9bis.pl</title>
</head>
<body>
Witaj <b>'.$sDetail1['first'].' '.$sDetail1['last'].'</b>!
<br><br>
Dziękujemy za zamówienie nr <b>'.$sDetail1['reference'].' </b>złożone w sklepie Modele-Ad9bis!<br>
W związku z faktem, iż było to 6. zamówienie spełniające kryteria promocji, przysługuje Ci 15% rabat.<br> Wartość zamówienia po aktualizacji o wspomniany rabat przedstawia się następująco:<br><br>
Ilość zamówionych pozycji: <b>'.$count.'</b><br>
Suma produktów z wysyłką (przed rabatem): '.$sDetail1["totalPaid"].'zł'.'<br>'.'Suma z wysyłką po rabacie: '.'<b>'.$new7.'zł'.'</b><br>
Prosimy o wpłatę na konto bankowe kwoty widocznej w niniejszym mailu.
<br><br>Zapraszamy do korzystania z naszego sklepu w przyszłości!<br><br>
Pozdrawiam serdecznie,<br>
Albert Ducin<br>
----------------------<br>
P.H.U. Ad9bis<br>
ul. Świerkowa 22,<br>
20-834 - Lublin<br>
(48) 660413844<br>
ad9bis@gmail.com
</body>
</html>
'; }
$headers  = 'MIME-Version: 1.0' . "\r\n";
$headers .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";
$headers .= 'From: ad9bis@gmail.com' . "\r\n";
if(mail($to, $subject, $message, $headers))
{
	echo 'Wiadomość została wysłana na adres: '.'<b>'.$sDetail1["mail"].'</b><br><br>Treść wiadomości:<br><fieldset id=\'confirm\'>'.$message.'</fieldset>';
}
else{
	echo 'Nie udało się wysłać maila.'; }
} } } 
if(isset($notification)){
	if(!isset($notificationresult[0])){
			echo'<b>'.'W bazie danych nie ma zamówienia o podanym numerze.'.'</b>'; exit; 
		} else {
	?>
	<h1>Wyślij numer przesłki - zamówienie nr <?php htmlout($notificationresult[0]);?>
	</h1><fieldset id="table"><table><form action="?shipmentNumber" method="post"><tr><td>
	Mail zostanie wysłany na adres:</td><td><input type="text" size="21" name="tracking" id="tracking" value="<?php htmlout($notificationresult[3]); ?>"></td></tr>
	<tr><td>Wpisz numer przesyłki (Poczta Polska)</td><td><input type="text" size="21" name="trackingNumber" id="tracking"></td><tr><td>
	<input type="hidden" name="idOrder" value="<?php htmlout($notificationresult[0])?>">
	<input type="hidden" name="reference" value="<?php htmlout($notificationresult[1])?>">
	<input type="hidden" name="name" value="<?php htmlout($notificationresult[4])?>">
	<input type="hidden" name="surname" value="<?php htmlout($notificationresult[5])?>">
	<input id="searchInput" type="submit" value="Wyślij mail">
</td></tr></form></table></fieldset>
	<?php
}
} ?>
<p><a href="?">Nowe wyszukiwanie</a></p>
</body>
</html>
